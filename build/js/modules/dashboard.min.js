"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Dashboard=void 0;var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var o=a[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(a,t,o){return t&&e(a.prototype,t),o&&e(a,o),a}}(),_character=require("./character.js"),_character2=_interopRequireDefault(_character),Dashboard=exports.Dashboard=function(){function e(){_classCallCheck(this,e),this.components={keysItem:{w:87,a:65,s:83,d:68},playerName:document.querySelector(".player-name"),health:document.querySelector(".health"),wrapLog:document.querySelector(".logs"),elLogs:document.querySelectorAll(".logs p"),elKeys:document.querySelectorAll(".key"),messages:document.querySelector(".messages"),animateLog:document.querySelector(".log-animate"),numbersLogs:document.querySelector(".numbers-logs")},this.gameStatus=!1,this.logs=[],this.currentLog=0}return _createClass(e,[{key:"attackProcess",value:function(e,a,t){e.health>0&&a.health>0&&(t(),a.health-=e.damage,e.health+=e.damage,e.timePoisoning>0?a.health-=e.poisonDamage:(e.poisonDamage=0,e.poison=!0),this.damageInfo(e),a.health<=0&&(this.diedInfo(a),this.gameStatus=!0))}},{key:"round",value:function(e){var a=this,t=e.keyCode;65===t&&player1.statusSkill&&player1.health>0&&(player1.statusSkill=!1,player1.timePoisoning>0&&(player1.timePoisoning-=1),this.attackProcess(player1,player2,player1.simpleAttack.bind(player1)),this.opponentSet()),68===t&&player1.statusSkill&&player1.health>0&&player1.potionHealth&&(player1.statusSkill=!1,player1.usePotionHealth(),this.potionInfo(player1),this.opponentSet()),87===t&&player1.statusSkill&&player1.health>0&&player1.frozen&&(player1.useFrozen(),this.frozenInfo(player1)),83===t&&player1.statusSkill&&player1.health>0&&(player1.statusSkill=!1,this.attackProcess(player1,player2,player1.poisonAttack.bind(player1)),this.opponentSet());for(var o=function(e){t===parseInt(a.components.elKeys[e].getAttribute("data-key"))&&(a.components.elKeys[e].classList.add("key-active"),setTimeout(function(){a.components.elKeys[e].classList.remove("key-active")},300))},s=0;s<this.components.elKeys.length;s++)o(s);this.updateHealth(),this.chatScroll()}},{key:"opponentSet",value:function(){var e=this,a=Math.floor(2001*Math.random())+1e3;player2.health>0&&setTimeout(function(){player2.potionHealth&&Math.floor(100*Math.random())<=25&&player2.health<=50?(player2.usePotionHealth(),e.potionInfo(player2),player1.statusSkill=!0):player2.frozen&&Math.floor(100*Math.random())<=25&&player2.health<=75?(player2.useFrozen(),e.frozenInfo(player2),setTimeout(function(){Math.floor(100*Math.random())<=35&&player2.poison?e.attackProcess(player2,player1,player2.poisonAttack.bind(player2)):(player2.timePoisoning-=1,e.attackProcess(player2,player1,player2.simpleAttack.bind(player2))),e.updateHealth(),player1.statusSkill=!0},a)):(Math.floor(100*Math.random())<=player2.poisonChance&&player2.poison?e.attackProcess(player2,player1,player2.poisonAttack.bind(player2)):(player2.timePoisoning-=1,e.attackProcess(player2,player1,player2.simpleAttack.bind(player2))),e.updateHealth(),player1.statusSkill=!0)},a)}},{key:"createLog",value:function(){var e=this;this.singleLog=document.createElement("p"),this.singleLog.classList.add("log_"+this.currentLog),this.logs.forEach(function(a,t){e.singleLog.innerHTML=a}),this.currentLog++,this.components.wrapLog.appendChild(this.singleLog)}},{key:"damageInfo",value:function(e){e.criticDamage>0&&0===e.poisonDamage?(this.logs.push(e.name+": critical damage "+e.damage),this.animateLog(e)):0===e.damage&&e.poison?(this.logs.push(e.name+": missed"),this.animateLog(e)):e.poisonDamage>0&&0===e.damage?this.logs.push(e.name+": missed and damage "+e.poisonDamage+" from poisoning"):e.poisonDamage>0&&e.criticDamage>0?this.logs.push(e.name+": critical damage "+e.damage+" and damage "+e.poisonDamage+" from poisoning"):e.poisonDamage>0?this.logs.push(e.name+": damage "+e.damage+" and damage "+e.poisonDamage+" from poisoning"):this.logs.push(e.name+": damage "+e.damage),this.createLog(),this.updateLogs(),this.chatScroll()}},{key:"potionInfo",value:function(e){this.logs.push(e.name+": use potion health"),this.createLog(),this.animateLog(e),this.updateLogs(),this.chatScroll()}},{key:"frozenInfo",value:function(e){this.logs.push(e.name+": your opponent is frozen"),this.createLog(),this.animateLog(e),this.updateLogs(),this.chatScroll()}},{key:"diedInfo",value:function(e){this.logs.push(e.name+": died"),this.animateLog(e),this.createLog(),this.updateLogs(),this.chatScroll()}},{key:"updateHealth",value:function(){this.components.health.innerHTML=player1.health,this.components.playerName.innerHTML=player1.name}},{key:"updateLogs",value:function(){this.components.numbersLogs.innerHTML=this.currentLog+"/"+this.currentLog}},{key:"animateLog",value:function(e){var a=this,t=this.logs[this.logs.length-1],o=e.name.length+2,s=t.slice(o,t.length);this.components.animateLog.innerHTML=s,this.components.animateLog.classList.add("active"),setTimeout(function(){a.components.animateLog.classList.remove("active")},2e3)}},{key:"chatScroll",value:function(){this.components.wrapLog.scrollTop=this.components.wrapLog.scrollHeight}},{key:"init",value:function(){this.gameStatus||document.addEventListener("keydown",this.round.bind(this),!1),this.updateHealth(),this.updateLogs()}}]),e}(),player1=new _character2["default"]("You"),player2=new _character2["default"]("Opponent");